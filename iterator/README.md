# Iterator パターン

## 概要

- 集約オブジェクトがもとにある内部表現を公開せず、その要素に順にアクセスする方法を提供する。集約オブジェクトの内部構造を隠蔽し、反復処理に関する詳細をカプセル化する。

## ２つの Iterator

### 外部 Iterator

- 反復処理を担当するのが集合とは別のオブジェクト
- 他のオブジェクトやメソッドと共有できる

### 内部 Iterator

- 反復処理を担当するのが集合自身（e.g. `each`メソッド）
- シンプルでコードが分かりやすい

### Enumerable

- 内部イテレータを持たせた場合、Enumerable モジュールを Mix-in しよう
- これによって集約オブジェクトを扱うさまざまな便利メソッドを手に入れられる

### Enumerable をインクルードする方法

- `each`という名前の内部イテレータメソッドを定義すること
- 適切な`<=>`メソッドを定義すること

## 使用上の注意

- 集約オブジェクトを反復処理している中で、集約オブジェクトに変更された場合に注意する。例えば、
  - 途中で要素が削除され、イテレータにずれが生じる場合
  - マルチスレッド化されたプログラムで、あるスレッドが集約オブジェクトを変更している場合
    - コピーした集約オブジェクトを走査することで対応できる

## 参考文献

- ラス・オルセン 「Ruby によるデザインパターン」 ピアソン・エデュケーション 2009
- [TECHSCORE](https://www.techscore.com/tech/DesignPattern/Iterator)
